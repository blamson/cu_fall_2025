windows_idx <- 1
# Go through each row, order em by distance and then
# iteratively add each nearest neighbor to the candidate windows
for (i in 1:nrow(d)) {
ordered_row <- order(d[i,]) # gives INDICES not values.
for (j in 1:length(ordered_row)) {
j_nn <- ordered_row[1:j] # Collect up to 'j' nearest neighbors
window_pop <- sum(dtf$population[c(j_nn)])
window_populations[windows_idx] <- window_pop
# print(window_pop)
windows[[windows_idx]] <- j_nn
windows_idx <- windows_idx + 1
}
}
for (i in 1:length(windows)) {
print(paste0("Window: ", windows[i]))
print(paste0("Population: ", window_populations[i]))
print("---")
}
# print(windows)
window_populations
pop_constraint <- total_pop / 2
which(window_populations <= pop_constraint)
pop_constraint <- total_pop / 2
retained_windows_idx <- which(window_populations <= pop_constraint)
retained_windows <- windows[retained_windows_idx]
print(retained_windows)
pop_constraint <- total_pop / 2
retained_windows_idx <- which(window_populations <= pop_constraint)
retained_windows <- windows[retained_windows_idx]
retained_populations <- window_populations[retained_windows_idx]
for (i in 1:length(retained_windows)) {
print(paste0("Window: ", retained_windows[i]))
print(paste0("Population: ", retained_populations[i]))
print("---")
}
pop_constraint <- total_pop / 2
retained_windows_idx <- which(window_populations <= pop_constraint)
retained_windows <- windows[retained_windows_idx]
retained_populations <- window_populations[retained_windows_idx]
for (i in 1:length(retained_windows)) {
print(paste0("--- Window: ", retained_windows[i]))
print(paste0("Population: ", retained_populations[i]))
}
pop_constraint <- total_pop / 2
retained_windows_idx <- which(window_populations <= pop_constraint)
retained_windows <- windows[retained_windows_idx]
retained_populations <- window_populations[retained_windows_idx]
for (i in 1:length(retained_windows)) {
print(paste0("Window: ", retained_windows[i]))
print(paste0("Population: ", retained_populations[i]))
print("---")
}
dtf
r <- sum(dtf$cases) / sum(dtf$population)
r
r <- sum(dtf$cases) / sum(dtf$population)
window_df <- data.frame(
regions = c(),
yin = c(),
ein = c(),
yout = c(),
eout = c()
)
# for ()
window_df
retained_windows
retained_populations
r <- sum(dtf$cases) / sum(dtf$population)
window_df <- data.frame(
regions = c(),
yin = c(),
ein = c(),
yout = c(),
eout = c()
)
for (i in 1:length(retained_windows)) {
print(retained_windows[i])
}
r <- sum(dtf$cases) / sum(dtf$population)
window_df <- data.frame(
regions = c(),
yin = c(),
ein = c(),
yout = c(),
eout = c()
)
for (i in 1:length(retained_windows)) {
window_df$regions[i] <- retained_windows[i]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
print(retained_windows[i])
}
r <- sum(dtf$cases) / sum(dtf$population)
window_df <- data.frame(
regions = retained_windows,
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = retained_windows,
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
n
retained_windows
data.frame(
x = retained_windows
)
data.frame
data.frame(
x = list(retained_windows)
)
retained_windows
data.frame(
x = I(retained_windows)
)
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
window_df$regions[i] <- retained_windows[i]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
print(retained_windows[i])
}
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
window_df$regions[i] <- retained_windows[i]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
}
window_df
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
window_df$regions[i] <- retained_windows[i]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
}
window_df
dtf[1]
dtf[1,]
dtf[1,"cases"]
dtf[1,"population"]
dtf[c(1,3),"population"]
dtf
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
# dtf[c(1,3),"population"]
}
window_df
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- dtf[retained_windows[i], "case"]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
# dtf[c(1,3),"population"]
}
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- dtf[retained_windows[i], "case"]
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- dtf[retained_windows[i], "case"]
print(yin)
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
dtf
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- dtf[retained_windows[i], "cases"]
print(yin)
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
retained_windows[1]
retained_windows[2]
c(retained_windows[i])
retained_windows[2,]
retained_windows[2]
as.vector(retained_windows[2])
c(1,4)
retained_windows[1,]
retained_windows[1]
retained_windows[1][1]
retained_windows[1]
retained_windows[2]
retained_windows[1]
retained_windows[[2]]
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- dtf[retained_windows[[i]], "cases"]
print(yin)
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- sum(dtf[retained_windows[[i]], "cases"])
print(yin)
ein <- r * retained_populations[i]
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
window_df
dtf
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- sum(dtf[retained_windows[[i]], "cases"])
ein <- r * sum(dtf[retained_windows[[i]], "population"])
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
window_df
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- sum(dtf[retained_windows[[i]], "cases"])
ein <- r * sum(dtf[retained_windows[[i]], "population"])
yout <- sum(dtf[-retained_windows[[i]], "cases"])
window_df$ein[i] <- ein
window_df$yin[i] <- yin
# dtf[c(1,3),"population"]
}
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
# window_df$regions[i] <- retained_windows[i]
yin <- sum(dtf[retained_windows[[i]], "cases"])
ein <- r * sum(dtf[retained_windows[[i]], "population"])
yout <- sum(dtf[-retained_windows[[i]], "cases"])
window_df$ein[i] <- ein
window_df$yin[i] <- yin
window_df$yout[i] <- yout
# dtf[c(1,3),"population"]
}
window_df
dtf
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
window_df$ein[i] <- r * sum(dtf[retained_windows[[i]], "population"])
window_df$yin[i] <- sum(dtf[retained_windows[[i]], "cases"])
window_df$yout[i] <- sum(dtf[-retained_windows[[i]], "cases"])
window_df$yout[i] <- r * sum(dtf[-retained_windows[[i]], "population"])
# dtf[c(1,3),"population"]
}
window_df
r <- sum(dtf$cases) / sum(dtf$population)
n <- length(retained_windows)
window_df <- data.frame(
regions = I(retained_windows),
yin = numeric(n),
ein = numeric(n),
yout = numeric(n),
eout = numeric(n)
)
# window_df$regions_str <- sapply(retained_windows, paste, collapse = ",")
for (i in 1:length(retained_windows)) {
window_df$ein[i] <- r * sum(dtf[retained_windows[[i]], "population"])
window_df$yin[i] <- sum(dtf[retained_windows[[i]], "cases"])
window_df$yout[i] <- sum(dtf[-retained_windows[[i]], "cases"])
window_df$eout[i] <- r * sum(dtf[-retained_windows[[i]], "population"])
# dtf[c(1,3),"population"]
}
window_df
exrow <- window_df[1,]
exrow
exrow <- window_df[1,]
t <- (exrow$yin / exrow$ein)^(exrow$yin) * (exrow$yout / exrow$yout)^(exrow$yout)
t
exrow <- window_df[1,]
in_frac <- exrow$yin / exrow$ein
out_frac <- exrow$yout / exrow$yout
check <- in_frac > out_frac
t <- 0
if (check) {
t <- in_frac^(exrow$yin) * out_frac^(exrow$yout)
}
t
exrow <- window_df[2,]
in_frac <- exrow$yin / exrow$ein
out_frac <- exrow$yout / exrow$yout
check <- in_frac > out_frac
t <- 0
if (check) {
t <- in_frac^(exrow$yin) * out_frac^(exrow$yout)
}
exrow <- window_df[2,]
in_frac <- exrow$yin / exrow$ein
out_frac <- exrow$yout / exrow$yout
check <- in_frac > out_frac
t <- 0
if (check) {
t <- in_frac^(exrow$yin) * out_frac^(exrow$yout)
}
t
exrow <- window_df[3,]
in_frac <- exrow$yin / exrow$ein
out_frac <- exrow$yout / exrow$yout
check <- in_frac > out_frac
t <- 0
if (check) {
t <- in_frac^(exrow$yin) * out_frac^(exrow$yout)
}
t
exrow <- window_df[3,]
in_frac <- exrow$yin / exrow$ein
out_frac <- exrow$yout / exrow$eout
check <- in_frac > out_frac
t <- 0
if (check) {
t <- in_frac^(exrow$yin) * out_frac^(exrow$yout)
}
t
window_df$test_stat <- apply(window_df, 1, function(row) {
yin <- as.numeric(row["yin"])
ein <- as.numeric(row["ein"])
yout <- as.numeric(row["yout"])
eout <- as.numeric(row["eout"])
in_frac <- yin / ein
out_frac <- yout / eout
check <- in_frac > out_frac
if (check) {
return((in_frac ^ yin) * (out_frac ^ yout))
} else {
return(0)
}
})
window_df
window_df$test_stat <- apply(window_df, 1, function(row) {
yin <- as.numeric(row["yin"])
ein <- as.numeric(row["ein"])
yout <- as.numeric(row["yout"])
eout <- as.numeric(row["eout"])
in_frac <- yin / ein
out_frac <- yout / eout
check <- in_frac >= out_frac
if (check) {
return((in_frac ^ yin) * (out_frac ^ yout))
} else {
return(0)
}
})
window_df
window_df$test_stat <- apply(window_df, 1, function(row) {
yin <- as.numeric(row["yin"])
ein <- as.numeric(row["ein"])
yout <- as.numeric(row["yout"])
eout <- as.numeric(row["eout"])
in_frac <- yin / ein
out_frac <- yout / eout
check <- in_frac >= out_frac
if (check) {
return((in_frac ^ yin) * (out_frac ^ yout))
} else {
return(0)
}
})
window_df

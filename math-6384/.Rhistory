# read shapefile for new york counties
ny8 <- sf::st_read("./data/NY_data/NY8_utm18.shp")
# plot(ny8["Cases"], pal = hcl.colors)
plot(scotlip_sf$cancer, pal = hcl.colors)
scotlip_sf$cancer
coords
# plot region boundaries from ny8
plot(st_geometry(ny8), border="grey60")
plot(st_geometry(scotlip_sf))
plot(st_geometry(scotlip_sf), coords=coords)
plot(coords)
load("scotlip_sf.rda")
#| include: false
library(smerc)
library(sf)
coords <- st_coordinates(st_centroid(st_geometry(scotlip_sf)))
plot(scotlip_sf)
scotlip_sf$cancer
scotlip_sf
plot(scotlip_sf$cancer, scotlip_sf$geometry)
plot(scotlip_sf)
str(scotlip_sf)
cancer <- scotlip_sf[["cancer", "geometry"]]
cancer
cancer <- scotlip_sf[, ["cancer"]]
cancer <- scotlip_sf[, c("cancer", "geometry")]
plot(scotlip_sf)
cancer <- scotlip_sf[, c("cancer", "geometry")]
plot(cancer)
map_subset <- scotlip_sf[, c("expected", "cancer", "geometry")]
plot(cancer)
map_subset <- scotlip_sf[, c("expected", "cancer", "geometry")]
plot(map_subset)
map_subset <- scotlip_sf[, c("expected", "cancer", "geometry")]
plot(map_subset, pal = hcl.colors)
cancer <- scotlip_sf[, c("cancer", "geometry")]
plot(cancer, pal = hcl.colors)
cancer <- scotlip_sf[, c("cancer", "geometry")]
plot(cancer, pal = hcl.colors)
expected <- scotlip_sf[, c("expected", "geometry")]
plot(expected, pal = hcl.colors)
namessss <- scotlip_sf[, c("name", "geometry")]
plot(namessss)
scotlip_sf[scotlip_sf$cancer > 30,]
scotlip_sf[scotlip_sf$cancer > 20,]
scotlip_sf[scotlip_sf$cancer > 20,]
scotlip_sf[scotlip_sf$cancer >= 20,]
cancer[cancer$cancer >= 20,]
plot(cancer[cancer$cancer >= 20,])
cancer[cancer$cancer >= 20,]
scotlip_sf
cepp150k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 150000,
alpha = 0.10)
summary(cepp150k)
cepp150k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 150000,
alpha = 0.10)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp150k))
legend("topright", legend = c("n* = 150k"))
# basic plot
plot(cepp150k)
# basic info
cepp150k
# cluster info
summary(cepp150k)
clusters(cepp150k)
#| code-fold: true
#| code-summary: The code
cepp750k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 750000,
alpha = 0.10)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp750k))
legend("topright", legend = c("n* = 750k"))
# basic plot
plot(cepp750k)
# basic info
cepp750k
# cluster info
summary(cepp750k)
clusters(cepp750k)
#| code-fold: true
#| code-summary: The code
cepp1500k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 1500000,
alpha = 0.10)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp1500k))
legend("topright", legend = c("n* = 1500k"))
# basic plot
plot(cepp1500k)
# basic info
cepp1500k
# cluster info
summary(cepp1500k)
clusters(cepp1500k)
packages <- c("spatstat", "pbapply", "smacpod")
for (pkg in packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
install.packages(pkg, repos = "https://cran.rstudio.com/")
library(pkg, character.only = TRUE)
}
}
# options(scipen=9999)
load("scotlip_sf.rda")
#| include: false
library(smerc)
library(sf)
coords <- st_coordinates(st_centroid(st_geometry(scotlip_sf)))
cancer <- scotlip_sf[, c("cancer", "geometry")]
plot(cancer, pal = hcl.colors)
expected <- scotlip_sf[, c("expected", "geometry")]
plot(expected, pal = hcl.colors)
#| code-fold: true
#| code-summary: The code
cepp150k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 150000,
alpha = 0.10)
# basic info
cepp150k
# cluster info
summary(cepp150k)
clusters(cepp150k)
#| code-fold: true
#| code-summary: The code
cepp750k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 750000,
alpha = 0.10)
# basic info
cepp750k
# cluster info
summary(cepp750k)
clusters(cepp750k)
#| code-fold: true
#| code-summary: The code
cepp1500k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 1500000,
alpha = 0.10)
# basic info
cepp1500k
# cluster info
summary(cepp1500k)
clusters(cepp1500k)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp150k))
legend("topright", legend = c("n* = 150k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp750k))
legend("topright", legend = c("n* = 750k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp1500k))
legend("topright", legend = c("n* = 1500k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp150k))
legend("topright", legend = c("n* = 150k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp750k))
legend("topright", legend = c("n* = 750k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp1500k))
legend("topright", legend = c("n* = 1500k"))
packages <- c("spatstat", "pbapply", "smacpod")
for (pkg in packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
install.packages(pkg, repos = "https://cran.rstudio.com/")
library(pkg, character.only = TRUE)
}
}
# options(scipen=9999)
load("scotlip_sf.rda")
#| include: false
library(smerc)
library(sf)
coords <- st_coordinates(st_centroid(st_geometry(scotlip_sf)))
cancer <- scotlip_sf[, c("cancer", "geometry")]
plot(cancer, pal = hcl.colors)
expected <- scotlip_sf[, c("expected", "geometry")]
plot(expected, pal = hcl.colors)
#| code-fold: true
#| code-summary: The code
cepp150k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 150000,
alpha = 0.01)
# basic info
cepp150k
# cluster info
summary(cepp150k)
clusters(cepp150k)
#| code-fold: true
#| code-summary: The code
cepp750k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 750000,
alpha = 0.01)
# basic info
cepp750k
# cluster info
summary(cepp750k)
clusters(cepp750k)
#| code-fold: true
#| code-summary: The code
cepp1500k = cepp.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
nstar = 1500000,
alpha = 0.01)
# basic info
cepp1500k
# cluster info
summary(cepp1500k)
clusters(cepp1500k)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp150k))
legend("topright", legend = c("n* = 150k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp750k))
legend("topright", legend = c("n* = 750k"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(cepp1500k))
legend("topright", legend = c("n* = 1500k"))
bn6 = bn.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
cstar = 6,
alpha = 0.01)
bn6 # simple info
summary(bn6) # cluster info
clusters(bn6)
bn27 = bn.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
cstar = 27,
alpha = 0.01)
bn6 # simple info
summary(bn27) # cluster info
clusters(bn27)
bn54 = bn.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
cstar = 54,
alpha = 0.01)
bn6 # simple info
summary(bn54) # cluster info
clusters(bn54)
#| code-fold: true
#| code-summary: The code
bn54 = bn.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
cstar = 54,
alpha = 0.01)
bn54 # simple info
summary(bn54) # cluster info
clusters(bn54)
#| code-fold: true
#| code-summary: The code
bn27 = bn.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
cstar = 27,
alpha = 0.01)
bn27 # simple info
summary(bn27) # cluster info
clusters(bn27)
library(RColorBrewer)
display.brewer.all(type = "qual", colorblindFriendly = TRUE)
mycol = brewer.pal(4, "Dark2")
nycol = rep("white", nrow(scotlip_sf))
nycol[bn6$clusters[[1]]$locids] = mycol[1]
nycol[bn27$clusters[[1]]$locids] = mycol[4]
nycol[bn54$clusters[[1]]$locids] = mycol[3]
# plot most likely clusters
plot(st_geometry(scotlip_sf), border="grey60", axes = TRUE, col = nycol)
legend("topright",
legend = c("Cluster k = 6, 17", "Cluster k = 12",
"Cluster k = 17", "Cluster k = 23"),
lwd = 10, col = mycol)
library(RColorBrewer)
display.brewer.all(type = "qual", colorblindFriendly = TRUE)
mycol = brewer.pal(4, "Dark2")
nycol = rep("white", nrow(scotlip_sf))
nycol[bn6$clusters[[1]]$locids] = mycol[1]
nycol[bn27$clusters[[1]]$locids] = mycol[4]
nycol[bn54$clusters[[1]]$locids] = mycol[3]
# plot most likely clusters
plot(st_geometry(scotlip_sf), border="grey60", axes = TRUE, col = nycol)
# legend("topright",
#        legend = c("Cluster k = 6, 17", "Cluster k = 12",
#                   "Cluster k = 17", "Cluster k = 23"),
#        lwd = 10, col = mycol)
scotcol
library(RColorBrewer)
display.brewer.all(type = "qual", colorblindFriendly = TRUE)
mycol = brewer.pal(4, "Dark2")
scotcol = rep("white", nrow(scotlip_sf))
scotcol[bn6$clusters[[1]]$locids] = mycol[1]
scotcol[bn27$clusters[[1]]$locids] = mycol[4]
scotcol[bn54$clusters[[1]]$locids] = mycol[3]
# plot most likely clusters
plot(st_geometry(scotlip_sf), border="grey60", axes = TRUE, col = scotcol)
# legend("topright",
#        legend = c("Cluster k = 6, 17", "Cluster k = 12",
#                   "Cluster k = 17", "Cluster k = 23"),
#        lwd = 10, col = mycol)
scotcol
library(RColorBrewer)
display.brewer.all(type = "qual", colorblindFriendly = TRUE)
mycol = brewer.pal(4, "Dark2")
scotcol = rep("white", nrow(scotlip_sf))
scotcol[bn6$clusters[[1]]$locids] = mycol[1]
scotcol[bn27$clusters[[1]]$locids] = mycol[4]
scotcol[bn54$clusters[[1]]$locids] = mycol[3]
# plot most likely clusters
plot(st_geometry(scotlip_sf), border="grey60", axes = TRUE, col = scotcol)
legend("topright",
legend = c("Cluster c^* = 6", "Cluster c^* = 27",
"Cluster c^* = 54"),
lwd = 10, col = mycol)
library(RColorBrewer)
display.brewer.all(type = "qual", colorblindFriendly = TRUE)
mycol = brewer.pal(4, "Dark2")
scotcol = rep("white", nrow(scotlip_sf))
scotcol[bn6$clusters[[1]]$locids] = mycol[1]
scotcol[bn27$clusters[[1]]$locids] = mycol[4]
scotcol[bn54$clusters[[1]]$locids] = mycol[3]
# plot most likely clusters
plot(st_geometry(scotlip_sf), border="grey60", axes = TRUE, col = scotcol)
legend("topright",
legend = c("Cluster c^* = 6", "Cluster c^* = 27",
"Cluster c^* = 54"),
lwd = 10, col = scotcol)
library(RColorBrewer)
display.brewer.all(type = "qual", colorblindFriendly = TRUE)
mycol = brewer.pal(4, "Dark2")
scotcol = rep("white", nrow(scotlip_sf))
scotcol[bn6$clusters[[1]]$locids] = mycol[1]
scotcol[bn27$clusters[[1]]$locids] = mycol[2]
scotcol[bn54$clusters[[1]]$locids] = mycol[3]
# plot most likely clusters
plot(st_geometry(scotlip_sf), border="grey60", axes = TRUE, col = scotcol)
legend("topright",
legend = c("Cluster c^* = 6", "Cluster c^* = 27",
"Cluster c^* = 54"),
lwd = 10, col = mycol)
packages <- c("spatstat", "pbapply", "smacpod", "RColorBrewer")
for (pkg in packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
install.packages(pkg, repos = "https://cran.rstudio.com/")
library(pkg, character.only = TRUE)
}
}
# options(scipen=9999)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(bn6))
legend("topright", legend = c("c* = 6"))
#| code-fold: true
#| code-summary: Plots on different maps
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(bn6))
legend("topright", legend = c("c* = 6"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(bn27))
legend("topright", legend = c("c* = 27"))
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(bn54))
legend("topright", legend = c("c* = 54"))
bn54$clusters
scan = scan.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
ex = scotlip_sf$expected,
nsim = 999,
alpha  = 0.1)
scan
spsca.test
spscan.test
scan = scan.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
ex = scotlip_sf$expected,
ubpo=0.1
)
scan = scan.test(coords = coords,
cases = scotlip_sf$cancer,
pop = scotlip_sf$population,
ex = scotlip_sf$expected,
ubpo=0.1
)
summary(scan)
plot(sf::st_geometry(scotlip_sf), border = "grey60", axes = TRUE,
col = color.clusters(scan))
load("lip_sf.rda")
load("lip_sf.rda")
#| include: false
library(sf)
library(smerc)
library(spdep)
coords <- st_coordinates(st_centroid(st_geometry(lip_sf)))
lip_nb <- poly2nb(lip_sf, queen=TRUE)
plot(lip_nb, coords = coords,
add=TRUE, col="blue", pch = 19, cex = 0.6)
plot(coords, border="grey60")
plot(lip_nb, coords = coords,
add=TRUE, col="blue", pch = 19, cex = 0.6)
plot(coords, border="grey60")
plot(lip_nb)
plot(coords, border="grey60")
plot(lip_nb)
plot(coords)
plot(lip_nb)
coords
lip_nb
plot(coords)
plot(lip_nb)
plot(coords)
plot(lip_nb, coords = coords)
plot(coords)
plot(lip_nb, coords = coords, add=TRUE)
plot(coords)
plot(lip_nb, coords = coords, add=TRUE, pch=19, cex=0.6)
st_geometry(lip_sf)
# plot(coords)
plot(st_geometry(lip_sf))
plot(lip_nb, coords = coords, add=TRUE, pch=19, cex=0.6)
# plot(coords)
plot(st_geometry(lip_sf))
plot(lip_nb, coords = coords, add=TRUE, pch=19, cex=0.6, col="blue")
# plot(coords)
plot(st_geometry(lip_sf), border="grey60")
plot(lip_nb, coords = coords, add=TRUE, pch=19, cex=0.6, col="blue")
w <- nb2mat(lip_nb, style="B")
w
lip_nb
lip_sf
w <- nb2mat(lip_nb, style="B")
moran.test(lip_sf$expected, listw = w, randomisation = FALSE)
lw <- nb2listw(lip_nb, style="B")
moran.test(lip_sf$expected, listw = lw, randomisation = FALSE)
w
w[1,]
?nb2listw
# Style = "W" for weight standardization
lw <- nb2listw(lip_nb, style="W")
moran.test(lip_sf$expected, listw = lw, randomisation = FALSE)
lw[0,]
lw
lw$neighbours
lw$weights
# Style = "B" for binary
lw <- nb2listw(lip_nb, style="B")
moran.test(lip_sf$expected, listw = lw, randomisation = FALSE)
# Style = "W" for weight standardization
lw <- nb2listw(lip_nb, style="W")
moran.test(lip_sf$expected, listw = lw, randomisation = TRUE)
# Style = "W" for weight standardization
lw <- nb2listw(lip_nb, style="W")
moran.test(lip_sf$expected, listw = lw, randomisation = FALSE)
w5k <- dweights(coords, kappa=5000)
w5k
w5k <- dweights(coords, kappa=5000)
w200k <- dweights(coords, kappa=200000)
lip_sf$cancer
w5k <- dweights(coords, kappa=5000)
w200k <- dweights(coords, kappa=200000)
(tango_mc5k <-  tango.test(lip_sf$cancer, lip_sf$population, w5k, nsim = 9999))
w5k <- dweights(coords, kappa=5000)
w200k <- dweights(coords, kappa=200000)
(tango_mc5k <-  tango.test(lip_sf$cancer, lip_sf$population, w5k, nsim = 9999))
(tango_mc200k <-  tango.test(lip_sf$cancer, lip_sf$population, w200k, nsim = 9999))
w5k <- dweights(coords, kappa=5000)
w200k <- dweights(coords, kappa=200000)
(tango_mc5k <-  tango.test(lip_sf$cancer, lip_sf$population, w5k, nsim = 9999))
print("---")
(tango_mc200k <-  tango.test(lip_sf$cancer, lip_sf$population, w200k, nsim = 9999))
w5k <- dweights(coords, kappa=5000)
w200k <- dweights(coords, kappa=200000)
print("kappa=5k")
(tango_mc5k <-  tango.test(lip_sf$cancer, lip_sf$population, w5k, nsim = 499))
print("kappa=200k")
(tango_mc200k <-  tango.test(lip_sf$cancer, lip_sf$population, w200k, nsim = 499))
plot(tango_mc5k)
plot(tango_mc200k)
hist(tango_mc5k$gof.sim, xlim = range(c(tango_mc5k$gof.sim, tango_mc5k$gof)))
abline(v = tango_mc5k$gof)
hist(tango_mc5k$sa.sim, xlim = range(c(tango_mc5k$sa.sim, tango_mc5k$sa)))
abline(v = tango_mc5k$sa)
hist(tango_mc200k$gof.sim, xlim = range(c(tango_mc200k$gof.sim, tango_mc200k$gof)))
abline(v = tango_mc200k$gof)
hist(tango_mc200k$sa.sim, xlim = range(c(tango_mc200k$sa.sim, tango_mc200k$sa)))
abline(v = tango_mc200k$sa)
hist(tango_mc5k$gof.sim, xlim = range(c(tango_mc5k$gof.sim, tango_mc5k$gof)))
abline(v = tango_mc5k$gof)
tango_mc200k

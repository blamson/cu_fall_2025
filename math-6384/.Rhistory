psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
# ini cov pars: c(partial sill, range)
lfita = likfit(geocow, ini.cov.pars = c(6000, 50),
nugget = 1000,
cov.model = "spherical",
lik.method = "REML")
# partial sill: 1.162
# range: 19.26
# nugget: 0
lfitb = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "spherical",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfitb)
summary(lfitb)
summary(lfita)
lfitc = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "exponential",
lik.method = "REML")
summary(lfitc)
lfitd = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfitd)
lfite = likfit(geocow, ini.cov.pars = c(100, 10000),
nugget = 50,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfite)
lfite = likfit(geocow, ini.cov.pars = c(1, 1),
nugget = 10,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfite)
lfite = likfit(geocow, ini.cov.pars = c(1, 1),
nugget = 0.1,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfite)
lfite = likfit(geocow, ini.cov.pars = c(1, 1),
nugget = 0,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfite)
lfite = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
summary(lfitd)
lfite = likfit(geocow, ini.cov.pars = c(1, 5),
nugget = 0,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
lfite
summary(lfite)
#| code-fold: true
#| code-summary: All the model code
# SPHERICAL ---
# ini cov pars: c(partial sill, range)
lfita = likfit(geocow, ini.cov.pars = c(6000, 50),
nugget = 1000,
cov.model = "spherical",
lik.method = "REML")
lfitb = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "spherical",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
#| code-fold: true
#| code-summary: All the model code
# SPHERICAL ---
# ini cov pars: c(partial sill, range)
lfita = likfit(geocow, ini.cov.pars = c(6000, 50),
nugget = 1000,
cov.model = "spherical",
lik.method = "REML")
lfitb = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "spherical",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
#| code-fold: true
#| code-summary: All the model code
# SPHERICAL ---
# ini cov pars: c(partial sill, range)
lfita = likfit(geocow, ini.cov.pars = c(6000, 50),
nugget = 1000,
cov.model = "spherical",
lik.method = "REML")
lfitb = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "spherical",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
#| code-fold: true
#| code-summary: All the model code
# SPHERICAL ---
sink(tempfile())
# ini cov pars: c(partial sill, range)
lfita = likfit(geocow, ini.cov.pars = c(6000, 50),
nugget = 1000,
cov.model = "spherical",
lik.method = "REML")
lfitb = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "spherical",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
# EXPONENTIAL ---
lfitc = likfit(geocow, ini.cov.pars = c(1, 10),
nugget = 1,
cov.model = "exponential",
lik.method = "REML")
lfitd = likfit(geocow, ini.cov.pars = c(1, 5),
nugget = 0,
cov.model = "exponential",
lik.method = "REML",
psiA = pi/2, psiR = 1,
fix.psiR = FALSE, fix.psiA = FALSE)
sink()
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
variogram(cow_sf)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
g_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
variogram(g_cow)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gtstat_variog,
vgm(psill = 1, model = "Sph", range = 5, nugget = 0),
fit.method = 2, fit.kappa = FALSE)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 1, model = "Sph", range = 5, nugget = 0),
fit.method = 2, fit.kappa = FALSE)
gfit1
gstat_variog
plot(gstat_variog)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 1, model = "Sph", range = 2, nugget = 0),
fit.method = 2, fit.kappa = FALSE)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 1, model = "Sph", range = 2, nugget = 0),
fit.method = 1, fit.kappa = FALSE)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 1, model = "Sph", range = 2, nugget = 0),
fit.method = 2, fit.kappa = FALSE)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 1, model = "Sph", range = 2, nugget = 0),
fit.method = 1, fit.kappa = FALSE)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 1, model = "Sph", range = 2, nugget = 0),
fit.method = 2, fit.kappa = FALSE)
# variog1 = variogram(gox, cutoff = 600, width = 600/16)
gstat_cow <- gstat(id = "W", formula = W ~ 1, data = cow_sf)
gstat_variog <- variogram(g_cow)
gfit1 = fit.variogram(gstat_variog,
vgm(psill = 0.5, model = "Sph", range = 10, nugget = 0.1),
fit.method = 2, fit.kappa = FALSE)
gfit1
summary(gfit1)
table(gstat_variog)
table(gstat_variog)
gstat_variog
# geoR REML parameters taken directly from above fit
psill_geoR <- 1.158
range_geoR <- 3.276
nugget_geoR <- 0.102
angle_deg <- 45
ratio <- 2
# Build the two gstat objects (no fit)
# 1) microscale error: ordinary kriging
gstat_std <- gstat(id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(psill = psill_geoR,
model = "Exp",
range = range_geoR,
nugget = nugget_geoR,
anis = c(angle_deg, ratio)))
# 2) measurement error: filtered kriging
gstat_filtered <- gstat(id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(psill = psill_geoR,
model = "Exp",
range = range_geoR,
nugget = nugget_geoR,
anis = c(angle_deg, ratio)))
gstat_filtered
# This will be our guide for converting from geoR output to gstat
# vgm(c, "model", amax = amin * psiR, c0),
#     anis = c(angle, 1/psiR = amin/amax)
# geoR REML parameters taken directly from above fit
psill_geoR <- 1.158     # c
range_geoR <- 3.276     # amin
nugget_geoR <- 0.102    # c0
psiA_geoR <- 45         # angle
psiR_geoR <- 2          # ratio
amax <- range_geoR * psiR_geoR
# Build the two gstat objects (no fit)
# 1) microscale error: ordinary kriging
gstat_std <- gstat(id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(psill = psill_geoR,
model = "Sph",
range = range_geoR,
nugget = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)))
# 2) measurement error: filtered kriging
gstat_filtered <- gstat(id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(psill = psill_geoR,
model = "Sph",
range = range_geoR,
nugget = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)))
gstat_std`
gstat_std
q
quit
quit()
gstat_std
gstat_filtered
# This will be our guide for converting from geoR output to gstat
# vgm(c, "model", amax = amin * psiR, c0),
#     anis = c(angle, 1/psiR = amin/amax)
# geoR REML parameters taken directly from above fit
psill_geoR <- 1.158     # c
range_geoR <- 3.276     # amin
nugget_geoR <- 0.102    # c0
psiA_geoR <- 45         # angle
psiR_geoR <- 2          # ratio
amax <- range_geoR * psiR_geoR
# Build the two gstat objects (no fit)
# 1) microscale error: ordinary kriging
gstat_obj <- gstat(
id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(
psill = psill_geoR,
model = "Sph",
range = range_geoR,
nugget = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)
)
)
# This will be our guide for converting from geoR output to gstat
# vgm(c, "model", amax = amin * psiR, c0),
#     anis = c(angle, 1/psiR = amin/amax)
# geoR REML parameters taken directly from above fit
psill_geoR <- 1.158     # c
range_geoR <- 3.276     # amin
nugget_geoR <- 0.102    # c0
psiA_geoR <- 45         # angle
psiR_geoR <- 2          # ratio
amax <- range_geoR * psiR_geoR
# Build the two gstat objects (no fit)
# 1) microscale error: ordinary kriging
gstat_ord <- gstat(
id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(
psill = psill_geoR,
model = "Sph",
range = range_geoR,
nugget = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)
)
)
gstat_filt <- gstat(
id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(
psill = psill_geoR,
model = "Sph",
range = range_geoR,
Err = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)
)
)
gstat_filt
# ordinary kriging predictions
ok <- predict(gstat_ord, newdata = grid_sf)
# filtered ordinary kriging
fok <- predict(gstat_filt, newdata = grid_sf)
# ordinary kriging predictions
ok <- predict(gstat_ord, newdata = grid_sf)
summary(ok)
# filtered ordinary kriging
fok <- predict(gstat_filt, newdata = grid_sf)
summary(fok)
# ordinary kriging predictions
ok <- predict(gstat_ord, newdata = grid_sf)
summary(ok)
# filtered ordinary kriging
fok <- predict(gstat_filt, newdata = grid_sf)
summary(fok)
fok
grid_sf
fok
plot(fok)
plot(ok)
gstat_ord
fok
ok
# filtered ordinary kriging
fok <- predict(gstat_filt, newdata = grid_sf)
summary(fok)
266-102
library(ggplot2)
# plot kriging predictions from ok model
ggplot(ok) +
geom_sf(aes(col = ph.var)) +
scale_color_viridis_c()
library(ggplot2)
# plot kriging predictions from ok model
ggplot(ok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c()
# plot kriging variance from ok model
ggplot(fok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c()
library(ggplot2)
# plot kriging predictions from ok model
ggplot(ok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c() +
ggtitle("Ordinary Kriging Variance")
# plot kriging variance from ok model
ggplot(fok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c() +
ggtitle("Filtered Ordinary Kriging Variance")
# Find the overall range of W.var across both datasets
lims <- range(c(ok$W.var, fok$W.var), na.rm = TRUE)
# Plot 1: Ordinary Kriging Variance
p1 <- ggplot(ok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Ordinary Kriging Variance")
# Plot 2: Filtered Ordinary Kriging Variance
p2 <- ggplot(fok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Filtered Ordinary Kriging Variance")
# Find the overall range of W.var across both datasets
lims <- range(c(ok$W.var, fok$W.var), na.rm = TRUE)
# Plot 1: Ordinary Kriging Variance
p1 <- ggplot(ok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Ordinary Kriging Variance")
# Plot 2: Filtered Ordinary Kriging Variance
p2 <- ggplot(fok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Filtered Ordinary Kriging Variance")
library(patchwork)
install.packages("patchwork")
# Find the overall range of W.var across both datasets
lims <- range(c(ok$W.var, fok$W.var), na.rm = TRUE)
# Plot 1: Ordinary Kriging Variance
p1 <- ggplot(ok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Ordinary Kriging Variance")
# Plot 2: Filtered Ordinary Kriging Variance
p2 <- ggplot(fok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Filtered Ordinary Kriging Variance")
library(patchwork)
p1 + p2  # side by side
# Find the overall range of W.var across both datasets
lims <- range(c(ok$W.var, fok$W.var), na.rm = TRUE)
# Plot 1: Ordinary Kriging Variance
p1 <- ggplot(ok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Ordinary Kriging Variance")
# Plot 2: Filtered Ordinary Kriging Variance
p2 <- ggplot(fok) +
geom_sf(aes(col = W.var)) +
scale_color_viridis_c(limits = lims) +
ggtitle("Filtered Ordinary Kriging Variance")
library(patchwork)
p1 + p2 + plot_layout(guides = "collect")
# filtered ordinary kriging
ok2 <- predict(gstat_ord, newdata = cow_sf)
summary(ok2)
# filtered ordinary kriging
fok2 <- predict(gstat_filt, newdata = cow_sf)
summary(fok2)
ok
fok
ok$W.pred
fok$W.pred
cow$W
mean(cow$W)
fok2$W.pred
ok$W.pred
ok2$W.pred
cow$W
head(cow$W)
head(ok2$W.pred)
head(fok2$W.pred)
head(cow$W, 10)
head(ok2$W.pred)
head(fok2$W.pred)
head(cow$W, 10)
head(ok2$W.pred, 10)
head(fok2$W.pred, 10)
matrix(data=c(1,0,1,0))
matrix(data=c(1,0,1,0), nrow=2)
matrix(data=c(1,0,1,0), nrow=2, byrow = T)
a <- matrix(data=c(1,0,1,0), nrow=2, byrow = T)
t(a)
a <- matrix(data=c(1,1,-1,-1), nrow=2, byrow = T)
t(a)
a <- matrix(c(1/200, 1/400, 1, 0, 0, 1, nrow=3, byrow=T))
a
a <- matrix(c(1/200, 1/400, 1, 0, 0, 1), nrow=3, byrow=T))
a <- matrix(c(1/200, 1/400, 1, 0, 0, 1), nrow=3, byrow=T)
a
t(a)
1/200
# ordinary kriging predictions
ok <- predict(gstat_ord, data=cow_sf, newdata = grid_sf)
summary(ok)
# ordinary kriging predictions
ok <- predict(gstat_ord, data=cow_sf, newdata = grid_sf)
summary(ok)
# This will be our guide for converting from geoR output to gstat
# vgm(c, "model", amax = amin * psiR, c0),
#     anis = c(angle, 1/psiR = amin/amax)
# geoR REML parameters taken directly from above fit
psill_geoR <- 1.158     # c
range_geoR <- 3.276     # amin
nugget_geoR <- 0.102    # c0
psiA_geoR <- 45         # angle
psiR_geoR <- 2          # ratio
amax <- range_geoR * psiR_geoR
# Build the two gstat objects (no fit)
# 1) microscale error: ordinary kriging
gstat_ord <- gstat(
id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(
psill = psill_geoR,
model = "Exp",
range = range_geoR,
nugget = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)
)
)
gstat_filt <- gstat(
id = "W", formula = W ~ 1, data = cow_sf,
model = vgm(
psill = psill_geoR,
model = "Exp",
range = range_geoR,
Err = nugget_geoR,
anis = c(psiA_geoR, 1/psiR_geoR)
)
)
# ordinary kriging predictions
ok <- predict(gstat_ord, data=cow_sf, newdata = grid_sf)
summary(ok)
# filtered ordinary kriging
fok <- predict(gstat_filt, newdata = grid_sf)
summary(fok)
# filtered ordinary kriging
fok <- predict(gstat_filt, data=cow_sf, newdata = grid_sf)
summary(fok)
ok$W.pred
head(ok$W.pred, 10)
head(fok$W.pred, 10)

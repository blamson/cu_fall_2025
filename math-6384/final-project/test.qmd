---
title: "test"
format: html
---

"Insect Species Occurrence Data from Multiple Projects Worldwide with Focus on Bees and Wasps in North America"

[Link](https://www.gbif.org/dataset/f519367d-6b9d-411c-b319-99424741e7de)

```{r}
library(readr)
library(dplyr)
library(sf)
library(smerc)
library(spdep)
```

```{r}
path <- "data/full_bee_dataset.csv"
df <- readr::read_delim(path, delim="\t")
```

```{r}
df
```

```{r}
df_slim <- df %>%
    select(
        c(
            "gbifID", "occurrenceID", "family", "scientificName", 
            "countryCode", "locality", "stateProvince", "individualCount", 
            "decimalLatitude", "decimalLongitude", 
            "eventDate", "day", "month", "year", "dateIdentified",
            "basisOfRecord", "institutionCode", "collectionCode"
        )
    ) %>% 
    tidyr::drop_na("decimalLongitude")

df_slim
```


Initial filtering steps: Filter down to - USA or CO - Just the bee families

Do some initial grouping on years, months for stuff - wanna figure out if its feasible to compare clustering of bees in colorado in 2000, 2010, 2020 and examine what those differences mean.

# Identifying the Bees

Tons of insect families in this dataset. Only so many are actually bees.

```{r}
df_slim %>%
    group_by(family) %>%
    count() %>%
    arrange(desc(n), )
```

Below table taken from the Taxonomic scope section of the docs.

| Family Name | Examples |
|------------------------------------|------------------------------------|
| Andrenidae | andrenid bees, andrenids |
| Apidae | bumble bees, euglossine, euglossines, honey bees, stingless bees |
| Colletidae | colletid bees, plasterer bees, yellow-faced bees |
| Crabronidae | crabronid wasps, cicadakillers, sand wasps, mud daubers |
| Halictidae | halictid bees, sweat bees |
| Megachilidae | leafcutting bees |
| Melittidae | melittid bees, melittids |
| Sphecidae | mud daubers, sphecid wasps, digger wasps, sand wasps |

```{r}
bee_families <- c("Andrenidae", "Apidae", "Colletidae", "Halictidae", "Megachilidae", "Melittidae")
bee_df <- df_slim %>% 
    filter(family %in% bee_families) %>%
    tidyr::drop_na("decimalLongitude")
```

```{r}
bee_df %>%
    group_by(family) %>%
    count() %>%
    arrange(desc(n), )
```

# Filter for location

Defining our study area is tough, what does the colorado subset of data look like. 

```{r}
AMERICA_bees <- bee_df %>% filter(countryCode == "US")
co_bees <- bee_df %>% filter(stateProvince == "Colorado")
```

```{r}
AMERICA_bees %>% group_by(stateProvince) %>% count() %>% arrange(stateProvince, desc(n))
```


```{r}
co_bees %>% group_by(locality) %>% count() %>% arrange(desc(n))
```

# What does each row represent? What can I even conclude from this data?

# Relevant papers made using this data

[Spatial patterns of bee captures in North American bowl trapping surveys](https://resjournals.onlinelibrary.wiley.com/doi/10.1111/j.1752-4598.2009.00074.x)


```{r}
sf <- st_as_sf(AMERICA_bees, coords=c("decimalLongitude", "decimalLatitude"))
coords <- st_coordinates(st_centroid(st_geometry(sf)))
plot(coords)
```

```{r}
library(sf)
library(ggplot2)
library(maps)

# convert your data to sf
sf_bees <- st_as_sf(AMERICA_bees, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326)

# get US states geometry and convert to sf
us_states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

# plot the states and your bee locations
ggplot() +
  geom_sf(data = us_states, fill = "white", color = "gray40") +
  geom_sf(data = sf_bees, color = "goldenrod2", alpha = 0.7, size = 1) +
  coord_sf(xlim = c(-125, -65), ylim = c(25, 50)) +
  theme_minimal() +
  labs(title = "Bee Observations Across the U.S.")

```



